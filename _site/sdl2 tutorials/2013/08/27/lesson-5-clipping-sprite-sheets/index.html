
<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Lesson 5: Clipping Sprite Sheets</title>
	
		<meta name="description" content="">
	
    <meta name="author" content="Will Usher">

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
	<![endif]-->

	<link href="/assets/bootstrap3/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/syntax.css" rel="stylesheet">
	<link href="/assets/custom.css" rel="stylesheet">
	<link rel="shortcut icon" href="/assets/img/identicon.ico">
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
</head>
<body>
	<div class="navbar navbar-inverse navbar-static-top" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="sr-only">Toggle nav</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/">Will Usher</a>
			</div>
			<div class="navbar-collapse collapse">
				<ul class="nav navbar-nav navbar-right">
					
					
					


  
    
      
        
      	<li><a href="/pages/sdl2">SDL2 Tutorials</a></li>
      	
      
    
  
    
      
        
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
        
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  





				</ul>
			</div><!--/.nav-collapse -->
		</div>
	</div>

	<div class="container content">
			
<div class="page-header">
	<h1>Lesson 5: Clipping Sprite Sheets <small></small></h1>
</div>

<div class="col-md-12">
	<div class="col-md-9">
		<p>It&#39;s common in sprite based games to use a larger image file containing many smaller images, such as the 
tiles for a tileset, instead of having a separate image file for each tile. This type of image is known
as a sprite sheet and is very handy to work with since we don&#39;t need to change which texture we&#39;re drawing
each time but rather just which subsection of the texture.</p>

<!--more-->

<p>In this lesson we&#39;ll see how to select subsections of textures using <a href="http://wiki.libsdl.org/SDL_RenderCopy"><code>SDL_RenderCopy</code></a> and also see a bit on detecting specific key press events, which we&#39;ll use to pick which section of 
the texture to draw. The sprite sheet will contain four different colored circles:</p>

<p><a href="https://github.com/Twinklebear/TwinklebearDev-Lessons/raw/master/res/Lesson5/image.png">
    <img width="200" height="auto" class="centered"
        src="https://github.com/Twinklebear/TwinklebearDev-Lessons/raw/master/res/Lesson5/image.png" />
</a>
<br /></p>

<p>A sprite sheet can be built up of many uniform sized sprites, in which case clipping is easy, or many different
sized sprites. To handle a sheet with varying sized sprites we&#39;d need a metadata file that contained the 
location information for the clips. For this lesson our sheet has 4 100x100 sprites. The code for this lesson builds 
off of lesson 4, if you don&#39;t have the code to build on top of
grab it from <a href="https://github.com/Twinklebear/TwinklebearDev-Lessons/tree/master/Lesson4">Github</a> and let&#39;s get
started!</p>

<h2>Selecting a Subsection of an Image</h2>

<p>Selecting the subsection of the texture that we want to draw is very easy with SDL. In Lesson 4, the remaining NULL
parameter that we&#39;re passing to <a href="http://wiki.libsdl.org/SDL_RenderCopy"><code>SDL_RenderCopy</code></a> is the source rect, 
which specifies the section of the texture we want to draw. When passing NULL we specify that we want the entire texture, 
but we can easily add a clip rect and start drawing only portions of the texture. To do this we&#39;ll be making 
some modifications to our renderTexture function to make it able to take a desired clipping rect, but still
keep some of the shorter syntax and conveniences from before.</p>

<h2>Modifying renderTexture</h2>

<p>To keep from tacking on more and more parameters to our renderTexture function and still maintain the convenience
the defaults provided we&#39;ll split it up into two functions. One is practically an identical call
to <code>SDL_RenderCopy</code> but provides the clip parameter with a default <code>nullptr</code> value. This version of renderTexture will take 
the destination as rect instead, which we can setup ourselves or have constructed by one of our other specialized 
renderTexture functions. The new base rendering function becomes very simple.</p>

<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/**</span>
<span class="cm">* Draw an SDL_Texture to an SDL_Renderer at some destination rect</span>
<span class="cm">* taking a clip of the texture if desired</span>
<span class="cm">* @param tex The source texture we want to draw</span>
<span class="cm">* @param ren The renderer we want to draw to</span>
<span class="cm">* @param dst The destination rectangle to render the texture to</span>
<span class="cm">* @param clip The sub-section of the texture to draw (clipping rect)</span>
<span class="cm">*      default of nullptr draws the entire texture</span>
<span class="cm">*/</span>
<span class="kt">void</span> <span class="nf">renderTexture</span><span class="p">(</span><span class="n">SDL_Texture</span> <span class="o">*</span><span class="n">tex</span><span class="p">,</span> <span class="n">SDL_Renderer</span> <span class="o">*</span><span class="n">ren</span><span class="p">,</span> <span class="n">SDL_Rect</span> <span class="n">dst</span><span class="p">,</span>
    <span class="n">SDL_Rect</span> <span class="o">*</span><span class="n">clip</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SDL_RenderCopy</span><span class="p">(</span><span class="n">ren</span><span class="p">,</span> <span class="n">tex</span><span class="p">,</span> <span class="n">clip</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dst</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

<p><br /></p>

<p>It was also really nice when we didn&#39;t need to create an SDL_Rect for our destination but could just provide
an x and y position and have our rendering function fill in the width and height of the texture. We&#39;ll create
an overloaded version of renderTexture that will do this, with some tweaks to handle clipping. We&#39;ll add
the clip rect as a parameter with <code>nullptr</code> as a default value and in the case that a clip was passed, we&#39;ll use 
the clip&#39;s width and height instead of the texture&#39;s width and height. This way we won&#39;t stretch a small
sprite to be the size of its potentially very large sprite sheet when it&#39;s drawn. This function is a modification of 
our original renderTexture function, and should look pretty similar.</p>

<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/**</span>
<span class="cm">* Draw an SDL_Texture to an SDL_Renderer at position x, y, preserving</span>
<span class="cm">* the texture&#39;s width and height and taking a clip of the texture if desired</span>
<span class="cm">* If a clip is passed, the clip&#39;s width and height will be used instead of</span>
<span class="cm">*  the texture&#39;s</span>
<span class="cm">* @param tex The source texture we want to draw</span>
<span class="cm">* @param ren The renderer we want to draw to</span>
<span class="cm">* @param x The x coordinate to draw to</span>
<span class="cm">* @param y The y coordinate to draw to</span>
<span class="cm">* @param clip The sub-section of the texture to draw (clipping rect)</span>
<span class="cm">*      default of nullptr draws the entire texture</span>
<span class="cm">*/</span>
<span class="kt">void</span> <span class="nf">renderTexture</span><span class="p">(</span><span class="n">SDL_Texture</span> <span class="o">*</span><span class="n">tex</span><span class="p">,</span> <span class="n">SDL_Renderer</span> <span class="o">*</span><span class="n">ren</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span>
    <span class="n">SDL_Rect</span> <span class="o">*</span><span class="n">clip</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SDL_Rect</span> <span class="n">dst</span><span class="p">;</span>
    <span class="n">dst</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="n">dst</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">clip</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">){</span>
        <span class="n">dst</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">clip</span><span class="o">-&gt;</span><span class="n">w</span><span class="p">;</span>
        <span class="n">dst</span><span class="p">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">clip</span><span class="o">-&gt;</span><span class="n">h</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">SDL_QueryTexture</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dst</span><span class="p">.</span><span class="n">w</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dst</span><span class="p">.</span><span class="n">h</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">renderTexture</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">ren</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">clip</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

<p><br /></p>

<h2>Determining the Clipping Rectangles</h2>

<p>In our case it&#39;s very easy to automatically compute the clipping rectangles, using a method almost identical
to the tiling method from <a href="http://twinklebear.github.io/sdl2%20tutorials/2013/08/18/lesson-3-sdl-extension-libraries/#tiling_the_background">Lesson 3</a>, however instead of going row by row, we&#39;ll go column by column. This way
clip one will be green, two is red, three is blue and four is yellow. The idea behind the math is the same as in
Lesson 3 but switched to wrap on columns. So our y coordinate is calculated by modding the tile index with the 
number of tiles (2), while the x coordinate is taken by dividing the index by the number of tiles. These x and y
coordinates are the x and y indices, so we then scale them to the actual pixel coordinates by multiplying by the 
clip width and height, which is uniform (100x100). Finally we pick a clip to start drawing, in this case the first one.</p>

<p>We also would like to draw our clips in the center of the screen, so we compute those x and y coordinates using
the clip&#39;s width and height instead of the texture&#39;s.</p>

<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="c1">//iW and iH are the clip width and height</span>
<span class="c1">//We&#39;ll be drawing only clips so get a center position for the w/h of a clip</span>
<span class="kt">int</span> <span class="n">iW</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">iH</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">SCREEN_WIDTH</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">iW</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">SCREEN_HEIGHT</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">iH</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

<span class="c1">//Setup the clips for our image</span>
<span class="n">SDL_Rect</span> <span class="n">clips</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">){</span>
    <span class="n">clips</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">iW</span><span class="p">;</span>
    <span class="n">clips</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">iH</span><span class="p">;</span>
    <span class="n">clips</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">w</span> <span class="o">=</span> <span class="n">iW</span><span class="p">;</span>
    <span class="n">clips</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">h</span> <span class="o">=</span> <span class="n">iH</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//Specify a default clip to start with</span>
<span class="kt">int</span> <span class="n">useClip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></code></pre></div>

<p><br /></p>

<p>If instead we were using some more complicated sprite sheet with rotated and different sized sprites packed together 
we would need to store their location and rotation information in some kind of metadata file so that we could find 
the clips easily.</p>

<h2>Changing Clips Based on Input</h2>

<p>In order to examine all the clips we&#39;ve created we&#39;ll add some key input handling to our event loop and will
make the keys 1-4 select which clip we want to display. To determine if a key press happened we can check
if our event is of the type <code>SDL_KEYDOWN</code> and if it is we can check if the key pressed was one of the keys we&#39;re interested
in by checking the keycode information in the event, <code>e.key.keysym.sym</code>.
A full list of <a href="http://wiki.libsdl.org/SDL_EventType">event types</a>, <a href="http://wiki.libsdl.org/SDL_Keycode">key codes</a>
and other <a href="http://wiki.libsdl.org/SDL_Event"><code>SDL_Event</code></a> information is available in the wiki.</p>

<p>When we receive the key input we&#39;re interested in we&#39;ll need to update the value of useClip to match the clip
we want to draw. With these additions our event loop will become:</p>

<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="k">while</span> <span class="p">(</span><span class="n">SDL_PollEvent</span><span class="p">(</span><span class="o">&amp;</span><span class="n">e</span><span class="p">)){</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SDL_QUIT</span><span class="p">)</span>
        <span class="n">quit</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="c1">//Use number input to select which clip should be drawn</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SDL_KEYDOWN</span><span class="p">){</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">key</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">sym</span><span class="p">){</span>
            <span class="k">case</span> <span class="nl">SDLK_1</span><span class="p">:</span>
                <span class="n">useClip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="nl">SDLK_2</span><span class="p">:</span>
                <span class="n">useClip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="nl">SDLK_3</span><span class="p">:</span>
                <span class="n">useClip</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="nl">SDLK_4</span><span class="p">:</span>
                <span class="n">useClip</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="nl">SDLK_ESCAPE</span><span class="p">:</span>
                <span class="n">quit</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p><br /></p>

<h2>Drawing our Clipped Image</h2>

<p>The final thing to do is get the clip we want on the screen! We&#39;ll do this by calling our more convenient
version of renderTexture to draw the clip without any extra scaling and passing in the clip we want to use
(the one at useClip).</p>

<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="n">SDL_RenderClear</span><span class="p">(</span><span class="n">renderer</span><span class="p">);</span>
<span class="n">renderTexture</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">clips</span><span class="p">[</span><span class="n">useClip</span><span class="p">]);</span>
<span class="n">SDL_RenderPresent</span><span class="p">(</span><span class="n">renderer</span><span class="p">);</span></code></pre></div>

<p><br /></p>

<h2>End of Lesson 5</h2>

<p>When you run the program you should see clip 0 (green circle) draw in the center of the screen and should be able to select 
different clips to be drawn with the number keys. If you run into any issues double check your code 
and/or post a question below.</p>

<p>I&#39;ll see you again soon in <a href="/sdl2%20tutorials/2013/12/18/lesson-6-true-type-fonts-with-sdl_ttf">Lesson 6: True Type Fonts with SDL_ttf!</a></p>

	</div>
	<div class="col-md-3">
		<h4><a href="/pages/sdl2/">Tutorial Index</a></h4>
		<h4>Helpful Links</h4>
		<a href="http://wiki.libsdl.org/moin.fcg/FrontPage">SDL Documentation</a>
		<br />
		<a href="http://forums.libsdl.org/">SDL Forums</a>
		<br />
		<a href="irc://irc.freenode.net/SDL">IRC: #SDL on freenode</a>
		<br />
		<a href="http://en.cppreference.com/w/">C++ Reference</a>
		<br />
		<a href="https://github.com/Twinklebear/TwinklebearDev-Lessons">Code on Github</a>
		<p>Published: 27 August 2013
	</div>
</div>
<div class="col-md-12 comments">
	


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'twinklebeargithub'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




</div>




	</div>

	
	<script src="https://code.jquery.com/jquery.js"></script>
	<script src="/assets/bootstrap3/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	</script>
</body>
</html>



