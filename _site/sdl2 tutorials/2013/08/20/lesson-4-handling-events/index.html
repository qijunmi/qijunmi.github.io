
<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Lesson 4: Handling Events</title>
	
		<meta name="description" content="Interacting with the User">
	
    <meta name="author" content="Will Usher">

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
	<![endif]-->

	<link href="/assets/bootstrap3/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/syntax.css" rel="stylesheet">
	<link href="/assets/custom.css" rel="stylesheet">
	<link rel="shortcut icon" href="/assets/img/identicon.ico">
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
</head>
<body>
	<div class="navbar navbar-inverse navbar-static-top" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="sr-only">Toggle nav</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/">Will Usher</a>
			</div>
			<div class="navbar-collapse collapse">
				<ul class="nav navbar-nav navbar-right">
					
					
					


  
    
      
        
      	<li><a href="/pages/sdl2">SDL2 Tutorials</a></li>
      	
      
    
  
    
      
        
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
        
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  





				</ul>
			</div><!--/.nav-collapse -->
		</div>
	</div>

	<div class="container content">
			
<div class="page-header">
	<h1>Lesson 4: Handling Events <small>Interacting with the User</small></h1>
</div>

<div class="col-md-12">
	<div class="col-md-9">
		<p>In this lesson we&#39;ll learn the basics of reading user input with SDL, in this simple example we&#39;ll interpret any input
as the user wanting to quit our application.
To read events SDL provides the <a href="http://wiki.libsdl.org/SDL_Event"><code>SDL_Event</code></a> structure
and functions to get events from the queue such as <a href="http://wiki.libsdl.org/SDL_PollEvent"><code>SDL_PollEvent</code></a>.
The code for this lesson is built off of the lesson 3 code, if you need that code to start from grab it on <a href="https://github.com/Twinklebear/TwinklebearDev-Lessons/tree/master/Lesson3">Github</a> and let&#39;s get started!</p>

<!--more-->

<p>The first change we need to make is to load our new image to display a prompt for input. Grab it below and use our <code>loadTexture</code> function to load it up as we did previously.</p>

<p><a href="https://github.com/Twinklebear/TwinklebearDev-Lessons/raw/master/res/Lesson4/image.png">
    <img width="500" height="auto" class="centered"
        src="https://github.com/Twinklebear/TwinklebearDev-Lessons/raw/master/res/Lesson4/image.png" />
</a></p>

<h2>A Basic Main Loop</h2>

<p>We&#39;ll be adding a main loop to keep the program running until the user quits so that they can use it as long as they want to, instead of for some fixed delay period. The structure of this loop will be very basic.</p>

<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">quit</span><span class="p">){</span>
    <span class="c1">//Read user input &amp; handle it</span>
    <span class="c1">//Render our scene</span>
<span class="p">}</span></code></pre></div>

<p><br /></p>

<h2>The SDL Event Queue</h2>

<p>To properly use SDL&#39;s event system we&#39;ll need at least some understanding of how SDL handles events. When SDL
receives an event it&#39;s pushed onto the back of a queue of all the other events that have been received but haven&#39;t been
polled yet. If we were to start our program and then resize the window, click the 
mouse and press a key the event queue would look like this.</p>

<p><img width="600" height="auto" class="centered" src="/assets/img/lesson_4/evntqueue.png"></p>

<p>When we call <code>SDL_PollEvent</code> we get the event at the front of the queue, which corresponds to the oldest
event since we last polled. Polling an event removes it from the queue, if we wanted to retrieve
some events without removing them we could use <a href="http://wiki.libsdl.org/SDL_PeepEvents"><code>SDL_PeepEvents</code></a> with the 
<code>SDL_PEEKEVENT</code> flag, but that&#39;s beyond the scope of this introduction. I encourage you to read the docs and check
it out later!</p>

<h2>Processing the Events</h2>

<p>In our main loop we&#39;ll want to read in every event that&#39;s occurred since the previous frame and handle them, 
we can do this by putting <a href="http://wiki.libsdl.org/SDL_PollEvent"><code>SDL_PollEvent</code></a> in a while loop, since the function will return 1 if an event was read in
and 0 if not. Since all we&#39;ll do is quit the program when we get an event we&#39;ll set a quit bool to track
whether the main loop should exit or not. So our event processing loop could look like this.</p>

<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="c1">//e is an SDL_Event variable we&#39;ve declared before entering the main loop</span>
<span class="k">while</span> <span class="p">(</span><span class="n">SDL_PollEvent</span><span class="p">(</span><span class="o">&amp;</span><span class="n">e</span><span class="p">)){</span>
    <span class="c1">//If user closes the window</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SDL_QUIT</span><span class="p">){</span>
        <span class="n">quit</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">//If user presses any key</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SDL_KEYDOWN</span><span class="p">){</span>
        <span class="n">quit</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">//If user clicks the mouse</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SDL_MOUSEBUTTONDOWN</span><span class="p">){</span>
        <span class="n">quit</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p><br /></p>

<p>The <code>SDL_QUIT</code> event occurs when the user closes our window, <code>SDL_KEYDOWN</code> occurs when a key is pressed and
<code>SDL_MOUSEBUTTONDOWN</code> occurs if a mouse button is pressed. These are just a few of the wide variety of events
that we can receive and I strongly recommend reading up about the other types in the
<a href="http://wiki.libsdl.org/SDL_Event"><code>SDL_Event</code> documentation</a>.</p>

<h2>Completing the Main Loop</h2>

<p>The final part of our main loop will take care of rendering our scene using the same methods as before. When we combine this with our event handling code our basic main loop becomes:</p>

<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="c1">//Our event structure</span>
<span class="n">SDL_Event</span> <span class="n">e</span><span class="p">;</span>
<span class="kt">bool</span> <span class="n">quit</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">quit</span><span class="p">){</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">SDL_PollEvent</span><span class="p">(</span><span class="o">&amp;</span><span class="n">e</span><span class="p">)){</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SDL_QUIT</span><span class="p">){</span>
            <span class="n">quit</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SDL_KEYDOWN</span><span class="p">){</span>
            <span class="n">quit</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SDL_MOUSEBUTTONDOWN</span><span class="p">){</span>
            <span class="n">quit</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//Render the scene</span>
    <span class="n">SDL_RenderClear</span><span class="p">(</span><span class="n">renderer</span><span class="p">);</span>
    <span class="n">renderTexture</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="n">SDL_RenderPresent</span><span class="p">(</span><span class="n">renderer</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

<p><br />
Our program will repeat until the user asks to exit and will re-draw our image each time.</p>

<h2>End of Lesson 4</h2>

<p>When you run the program you should be able to quit by closing the window, pressing any key or clicking the mouse.
If you have any issues double check your code and/or post your question below.</p>

<p><strong>Extra Fun:</strong> How could we move the image around? What about moving based on key input?</p>

<p>I&#39;ll see you again soon in <a href="/sdl2%20tutorials/2013/08/27/lesson-5-clipping-sprite-sheets">Lesson 5: Clipping Sprite Sheets!</a></p>

	</div>
	<div class="col-md-3">
		<h4><a href="/pages/sdl2/">Tutorial Index</a></h4>
		<h4>Helpful Links</h4>
		<a href="http://wiki.libsdl.org/moin.fcg/FrontPage">SDL Documentation</a>
		<br />
		<a href="http://forums.libsdl.org/">SDL Forums</a>
		<br />
		<a href="irc://irc.freenode.net/SDL">IRC: #SDL on freenode</a>
		<br />
		<a href="http://en.cppreference.com/w/">C++ Reference</a>
		<br />
		<a href="https://github.com/Twinklebear/TwinklebearDev-Lessons">Code on Github</a>
		<p>Published: 20 August 2013
	</div>
</div>
<div class="col-md-12 comments">
	


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'twinklebeargithub'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




</div>




	</div>

	
	<script src="https://code.jquery.com/jquery.js"></script>
	<script src="/assets/bootstrap3/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	</script>
</body>
</html>



